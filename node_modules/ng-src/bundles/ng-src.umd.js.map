{"version":3,"file":"ng-src.umd.js","sources":["~/ng-src/ng-src.module.ts","~/ng-src/ng-src.directive.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\n\nimport { NgSrcDirective } from './ng-src.directive';\nexport class NgSrcModule { static decorators: DecoratorInvocation[] = [\n{ type: NgModule, args: [{\n  declarations: [ NgSrcDirective ],\n  exports: [ NgSrcDirective ],\n}, ] },\n];\n/**\n * @nocollapse\n */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n];\n}\n\nfunction NgSrcModule_tsickle_Closure_declarations() {\n/** @type {?} */\nNgSrcModule.decorators;\n/**\n * @nocollapse\n * @type {?}\n */\nNgSrcModule.ctorParameters;\n}\n\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n","import {\n  Directive,\n  Input,\n  OnChanges,\n  ViewContainerRef,\n  EventEmitter,\n  Output,\n} from '@angular/core';\nexport class NgSrcDirective implements OnChanges {\n   ngSrc: string;\n\n   ngOnLoad = new EventEmitter<XMLHttpRequest>();\n/**\n * @return {?}\n */\nget hostImage(): HTMLImageElement {\n    return this.view.element.nativeElement;\n  }\n/**\n * @param {?} view\n */\nconstructor(private view: ViewContainerRef) { }\n/**\n * @return {?}\n */\nngOnChanges(): void {\n    this.fetchImage(this.ngSrc);\n  }\n/**\n * @param {?} url\n * @return {?}\n */\nprivate fetchImage(url: string) {\n    const /** @type {?} */ httpRequest = new XMLHttpRequest();\n\n    httpRequest.open('GET', url, true);\n    httpRequest.responseType = 'arraybuffer';\n    httpRequest.onload = this.onRequestLoaded.bind(this);\n\n    httpRequest.send();\n  }\n/**\n * @param {?} ev\n * @return {?}\n */\nprivate onRequestLoaded(ev: ProgressEvent): any {\n    const /** @type {?} */ request = /** @type {?} */(( ev.target as XMLHttpRequest));\n\n    const /** @type {?} */ imageUrl = this.createLocalResource(request);\n    this.setImageSource(imageUrl);\n\n    this.ngOnLoad.emit(request);\n  }\n/**\n * @param {?} request\n * @return {?}\n */\nprivate createLocalResource(request: XMLHttpRequest) {\n    const /** @type {?} */ arrayBufferView = new Uint8Array(request.response);\n    const /** @type {?} */ blob = new Blob([ arrayBufferView ], { type: this.getContentType(request) });\n\n    return URL.createObjectURL(blob);\n  }\n/**\n * @param {?} url\n * @return {?}\n */\nprivate setImageSource(url: string) {\n    this.hostImage.src = url;\n  }\n/**\n * @param {?} request\n * @return {?}\n */\nprivate getContentType(request: XMLHttpRequest) {\n    return request.getResponseHeader('content-type');\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Directive, args: [{\n  selector: '[ngSrc]img'\n}, ] },\n];\n/**\n * @nocollapse\n */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ViewContainerRef, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'ngSrc': [{ type: Input },],\n'ngOnLoad': [{ type: Output },],\n};\n}\n\nfunction NgSrcDirective_tsickle_Closure_declarations() {\n/** @type {?} */\nNgSrcDirective.decorators;\n/**\n * @nocollapse\n * @type {?}\n */\nNgSrcDirective.ctorParameters;\n/** @type {?} */\nNgSrcDirective.propDecorators;\n/** @type {?} */\nNgSrcDirective.prototype.ngSrc;\n/** @type {?} */\nNgSrcDirective.prototype.ngOnLoad;\n/** @type {?} */\nNgSrcDirective.prototype.view;\n}\n\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"],"names":["NgModule","Output","Input","ViewContainerRef","Directive","EventEmitter"],"mappings":"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"}
